<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ActivityWatch Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <!-- Load data.js first -->
    <script src="data.js"></script>
    <style>
        :root {
            --primary-color: #2196F3;
            --success-color: #4CAF50;
            --warning-color: #FFC107;
            --danger-color: #FF5722;
            --text-color: #2c3e50;
            --text-light: #7f8c8d;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --spacing-unit: 20px;
            --border-radius: 12px;
            --shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body { 
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--spacing-unit);
        }

        h1 { 
            font-size: 2.2em;
            margin-bottom: 0.3em;
            color: var(--text-color);
            font-weight: 600;
        }

        h2 { 
            font-size: 1.3em;
            margin-bottom: 1em;
            color: var(--text-color);
            font-weight: 500;
        }

        .last-update {
            color: var(--text-light);
            font-size: 0.9em;
            margin-bottom: 2em;
            font-weight: 400;
        }

        .summary {
            background: var(--card-bg);
            padding: calc(var(--spacing-unit) * 1.5);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: calc(var(--spacing-unit) * 2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5em;
            transition: var(--transition);
        }

        .summary:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .stat {
            text-align: center;
            min-width: 140px;
            padding: 0.5em;
            transition: var(--transition);
        }

        .stat:hover {
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 1.4em;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.2em;
        }

        .stat-percentage {
            color: var(--text-light);
            font-size: 0.9em;
            font-weight: 500;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: calc(var(--spacing-unit) * 1.5);
            margin-bottom: calc(var(--spacing-unit) * 2);
        }

        .chart-container {
            background: var(--card-bg);
            padding: calc(var(--spacing-unit) * 1.5);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            height: 400px;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .chart-container:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .full-width {
            grid-column: 1 / -1;
            height: 450px;
        }

        @media (max-width: 1200px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat {
                min-width: 120px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px 0;
            }

            .container {
                padding: 0 calc(var(--spacing-unit) * 0.8);
            }
            
            .summary {
                flex-direction: column;
                align-items: stretch;
                padding: calc(var(--spacing-unit) * 1.2);
            }
            
            .stat {
                min-width: auto;
                padding: 0.8em;
            }

            .grid {
                grid-template-columns: 1fr;
                gap: calc(var(--spacing-unit) * 1.2);
            }

            .chart-container {
                height: 350px;
            }

            .full-width {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ActivityWatch Data Visualizations</h1>
        <div class="last-update">Updated at: 2025-05-12 20:22</div>

        <div class="summary" id="summary-stats">
            <!-- Summary stats will be injected here -->
        </div>

        <div class="grid">
            <div class="chart-container full-width">
                <h2>Hourly Activity Pattern</h2>
                <canvas id="hourlyActivityChart"></canvas>
            </div>

            <div class="chart-container full-width">
                <h2>Daily Time Allocation</h2>
                <canvas id="dailyChart"></canvas>
            </div>

            <div class="chart-container">
                <h2>Applications</h2>
                <canvas id="topAppsChart"></canvas>
            </div>

            <div class="chart-container">
                <h2>Categories</h2>
                <canvas id="categoryChart"></canvas>
            </div>

            <div class="chart-container">
                <h2>Web Activity</h2>
                <canvas id="webChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof activityData === 'undefined') {
                console.error('activityData not found. Make sure data.js is loaded correctly.');
                return;
            }
            
            let charts = {
                dailyChart: null,
                topAppsChart: null,
                categoryChart: null,
                hourlyActivityChart: null,
                webChart: null
            };

            function updateCharts(data) {
                // Update summary stats
                const summaryHtml = `
                    <div class="stat">
                        <div class="stat-value">${data.start_date.split(',')[0]}</div>
                        <div class="stat-percentage">Time period</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.total_hours.toFixed(1)}h</div>
                        <div class="stat-percentage">Total time</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.active_hours.toFixed(1)}h</div>
                        <div class="stat-percentage">Active (${data.active_percentage.toFixed(0)}%)</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.productive_hours.toFixed(1)}h</div>
                        <div class="stat-percentage">Productive (${data.productive_percentage.toFixed(0)}%)</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.non_productive_hours.toFixed(1)}h</div>
                        <div class="stat-percentage">Non-productive (${data.non_productive_percentage.toFixed(0)}%)</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${data.other_hours.toFixed(1)}h</div>
                        <div class="stat-percentage">Other (${data.other_percentage.toFixed(0)}%)</div>
                    </div>
                `;
                document.getElementById('summary-stats').innerHTML = summaryHtml;

                const chartOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: { 
                                boxWidth: 12, 
                                padding: 15,
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            padding: 12,
                            titleFont: { size: 14 },
                            bodyFont: { size: 13 }
                        }
                    }
                };

                Object.values(charts).forEach(chart => {
                    if (chart) chart.destroy();
                });

                // Hourly Activity Pattern
                charts.hourlyActivityChart = new Chart(document.getElementById('hourlyActivityChart').getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: data.hour_labels,
                        datasets: [{ 
                            label: 'Activity (hours)', 
                            data: data.hour_data,
                            borderColor: '#2196F3',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        ...chartOptions,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Hours'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Hour of Day'
                                }
                            }
                        }
                    }
                });

                // Daily Time Allocation
                charts.dailyChart = new Chart(document.getElementById('dailyChart').getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: data.labels,
                        datasets: [
                            { label: 'Productive', data: data.productive, backgroundColor: '#4CAF50' },
                            { label: 'Non-Productive', data: data.non_productive, backgroundColor: '#FF5722' },
                            { label: 'Other', data: data.other, backgroundColor: '#FFC107' }
                        ]
                    },
                    options: {
                        ...chartOptions,
                        scales: { 
                            x: { stacked: true }, 
                            y: { 
                                stacked: true,
                                title: { display: true, text: 'Hours' }
                            } 
                        }
                    }
                });

                // Application Usage (Pie Chart)
                charts.topAppsChart = new Chart(document.getElementById('topAppsChart').getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: data.top_apps_labels,
                        datasets: [{ 
                            data: data.top_apps_data,
                            backgroundColor: data.top_apps_colors
                        }]
                    },
                    options: {
                        ...chartOptions,
                        plugins: {
                            ...chartOptions.plugins,
                            tooltip: {
                                ...chartOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: ${value.toFixed(1)}h (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });

                // Category Breakdown (Pie Chart)
                charts.categoryChart = new Chart(document.getElementById('categoryChart').getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: data.categories.map(cat => {
                            // Extract just the main activity from the category path
                            const parts = cat.split(' > ');
                            return parts[parts.length - 1];
                        }),
                        datasets: [{ 
                            data: data.category_data,
                            backgroundColor: data.category_colors
                        }]
                    },
                    options: {
                        ...chartOptions,
                        plugins: {
                            ...chartOptions.plugins,
                            tooltip: {
                                ...chartOptions.plugins.tooltip,
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: ${value.toFixed(1)}h (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });

                // Web Activity (Pie Chart)
                if (data.web_labels && data.web_labels.length > 0) {
                    charts.webChart = new Chart(document.getElementById('webChart').getContext('2d'), {
                        type: 'pie',
                        data: {
                            labels: data.web_labels,
                            datasets: [{ 
                                data: data.web_data,
                                backgroundColor: data.web_colors
                            }]
                        },
                        options: {
                            ...chartOptions,
                            plugins: {
                                ...chartOptions.plugins,
                                tooltip: {
                                    ...chartOptions.plugins.tooltip,
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.parsed || 0;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = ((value / total) * 100).toFixed(1);
                                            return `${label}: ${value.toFixed(1)}h (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                } else {
                    // Hide web chart container if no data
                    document.querySelector('.chart-container:has(#webChart)').style.display = 'none';
                }
            }

            updateCharts(activityData);
        });
    </script>
</body>
</html>